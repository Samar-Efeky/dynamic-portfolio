<form [formGroup]="form" class="min-h-screen w-full lg:px-6 md:px-4 px-2 py-6 flex justify-center items-start">
  <div class="w-full py-10 lg:px-6 md:px-4 px-2 rounded-[7px] shadow-xl" style="background-color: var(--sectionColor);">

    <!-- Page Title -->
    <h2 class="lg:text-[1.6rem] md:text-[1.5rem] text-[1.3rem] font-bold mb-10 span-color">
      Personal Information
    </h2>

    <!-- Inputs Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-4">

      <!-- Full Name -->
      <div>
        <label class="block mb-2 font-semibold">Full Name</label>
        <input type="text" formControlName="fullName"
               class="w-full p-3 form-control mb-4"
               placeholder="Full Name" />
        <!-- Full Name Error -->
        @if(form.get('fullName')?.touched && form.get('fullName')?.errors?.['required']) {
          <p class="text-red-400 text-sm mb-2">Full Name is required.</p>
        }
      </div>

      <!-- Username -->
      <div>
        <label class="block mb-2 font-semibold">Username (one word)</label>
        <input type="text" formControlName="username"
               class="w-full p-3 form-control mb-4"
               placeholder="Username" />
        <!-- Username Errors -->
        @if(form.get('username')?.touched && form.get('username')?.invalid) {
          <p class="text-red-400 text-sm mb-2">
            @if(form.get('username')?.errors?.['required']) { Username is required. }
            @if(form.get('username')?.errors?.['pattern']) { Username cannot contain spaces. }
            @if(form.get('username')?.errors?.['usernameTaken'] && form.get('username')?.value !== currentUsername) { Username already taken! }
          </p>
        }
      </div>

      <!-- Email -->
      <div>
        <label class="block mb-2 font-semibold">Email</label>
        <input type="text" formControlName="email"
               class="w-full p-3 form-control mb-4"
               placeholder="Email" />
        <!-- Email Errors -->
        @if(form.get('email')?.touched && form.get('email')?.invalid) {
          <p class="text-red-400 text-sm mb-2">
            @if(form.get('email')?.errors?.['required']) { Email is required. }
            @if(form.get('email')?.errors?.['email']) { Invalid email format. }
          </p>
        }
      </div>

      <!-- Phone -->
      <div>
        <label class="block mb-2 font-semibold">Phone</label>
        <input type="text" formControlName="phone"
               class="w-full p-3 form-control mb-4"
               placeholder="Phone" />
        <!-- Phone Errors -->
        @if(form.get('phone')?.touched && form.get('phone')?.invalid) {
          <p class="text-red-400 text-sm mb-2">
            @if(form.get('phone')?.errors?.['required']) { Phone is required. }
            @if(form.get('phone')?.errors?.['pattern']) { Phone must contain only numbers. }
          </p>
        }
      </div>

      <!-- Address -->
      <div>
        <label class="block mb-2 font-semibold">Address</label>
        <input type="text" formControlName="address"
               class="w-full p-3 form-control mb-4"
               placeholder="Your Address" />
        <!-- Address Error -->
        @if(form.get('address')?.touched && form.get('address')?.errors?.['required']) {
          <p class="text-red-400 text-sm mb-2">Address is required.</p>
        }
      </div>

      <!-- Main Job Title -->
      <div>
        <label class="block mb-2 font-semibold">Main Job Title</label>
        <input type="text" formControlName="mainJobTitle"
               class="w-full p-3 form-control mb-4"
               placeholder="Web Developer" />
        <!-- Main Job Title Error -->
        @if(form.get('mainJobTitle')?.touched && form.get('mainJobTitle')?.errors?.['required']) {
          <p class="text-red-400 text-sm mb-2">Main Job Title is required.</p>
        }
      </div>

    </div>

    <!-- Description -->
    <div class="mb-6 col-span-1 lg:col-span-2">
      <label class="block mb-2 font-semibold">Public Description</label>
      <textarea formControlName="publicDescription"
      #autoResizeTextArea
                (input)="autoResize($event)"
                class="w-full p-3 form-control mb-2"
                rows="5"
                placeholder="Write a brief description about yourself..."></textarea>
      <!-- Description Error -->
      @if(form.get('publicDescription')?.touched && form.get('publicDescription')?.errors?.['required']) {
        <p class="text-red-400 text-sm mb-2">Description is required.</p>
      }
    </div>
    <div>
      <label class="block mb-2 font-semibold">Add button in hero section (optional)</label>
        <input type="text" formControlName="buttonInHeroSection"
               class="w-full p-3 form-control mb-4"
               placeholder="Available To Work OR Currently Available For Freelance Worldwide" />
    </div>
    <!-- Profile Image -->
    <div class="mb-6">
      <label class="block mb-2 font-semibold">Profile Image</label>
      <input type="file"
             class="w-full p-3 form-control mb-3"
             (change)="uploadImage($event, 'profile')" />
      <!-- Profile Preview -->
      @if(profileImagePreview) {
        <div class="mb-4">
          <img [src]="profileImagePreview"
               class="w-[200px] object-cover rounded-md"
               alt="Profile Preview" />
        </div>
      }
    </div>

    <!-- Logo Image -->
    <div class="mb-6">
      <label class="block mb-2 font-semibold">Logo Image</label>
      <input type="file"
             class="w-full p-3 form-control mb-3"
             (change)="uploadImage($event, 'logo')" />
      <!-- Logo Preview -->
      @if(logoImagePreview) {
        <div class="mb-4">
          <img [src]="logoImagePreview"
               class="w-[200px] object-cover rounded-md"
               alt="Logo Preview" />
        </div>
      }
    </div>

    <!-- Social Media Links -->
    <label class="block mb-2 font-semibold">Social Media Links (Min 3 links)</label>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
      <input #platformName type="text"
             class="form-control p-3"
             placeholder="Platform Name (e.g. LinkedIn)"
             (input)="updateUrlPlaceholder(platformName.value)" />
      <input #platformUrl type="text"
             class="form-control p-3"
             [placeholder]="urlPlaceholder" />
    </div>
    <!-- Social Error -->
    @if(socialError) {
      <p class="text-red-400 text-sm mb-2">{{ socialError }}</p>
    }
    <button type="button"
            class="px-4 py-2 no-after-button mb-6"
            (click)="addSocial(platformName.value, platformUrl.value); platformName.value=''; platformUrl.value='';">
      Add
    </button>

    <!-- Social Links List -->
    <ul cdkDropList (cdkDropListDropped)="drop($event)" class="space-y-2 mt-4 w-full">
      @for(s of socialLinksArray.controls; track $index) {
        <li cdkDrag
            class="flex justify-between items-center p-3 rounded-lg w-full"
            style="background-color: var(--inputColor);">
          <div class="truncate">
            <span [innerHTML]="getPlatformIcon(s.value.platform)"></span>
            <strong class="text-main mr-2 span-color"> {{ s.value.platform }}:</strong>
            <a [href]="s.value.url" target="_blank" class="underline block truncate pt-2">{{ s.value.url }}</a>
          </div>
          <div class="flex items-center">
            <i cdkDragHandle class="fa-solid fa-grip-lines mx-2 cursor-move text-gray-400"></i>
            <button type="button" class="ml-4 px-1 rounded-[3px] no-after-button" (click)="removeSocial($index)">
              <i class="fa-solid fa-xmark text-[12px]"></i>
            </button>
          </div>
        </li>
      }
    </ul>

    <!-- Intro Video -->
    <div class="my-6">
      <label class="block mb-2 font-semibold">Intro Video (Optional)</label>
      <input type="file"
             accept="video/*"
             class="w-full p-3 form-control mb-3"
             (change)="uploadVideo($event)" />
      <!-- Video Error -->
      @if(videoError) {
        <p class="text-red-500 mb-2">{{ videoError }}</p>
      }

      <!-- Upload Progress -->
      @if(videoFile) {
        <p class="text-[15px]">Uploading: {{videoProgress}}%</p>
        <div class="w-full bg-gray-300 rounded h-2">
          <div class="h-2 rounded" style="background-color: var(--primaryColor);" [style.width.%]="videoProgress"></div>
        </div>
      }

      <!-- Video Preview -->
      @if(videoPreview || (form.value.introVideo && form.value.introVideo.trim() !== '')) {
        <div class="relative w-[250px] mt-3">
          <video [src]="videoPreview ? videoPreview : form.value.introVideo"
                 class="w-full rounded-md"
                 controls></video>
          <button (click)="removeVideo()"
                  class="no-after-button absolute top-1 right-1 bg-gray-800 text-white rounded-sm w-6 h-6 flex items-center justify-center">
            <i class="fa-solid fa-xmark text-[14px]"></i>
          </button>
        </div>
      }
    </div>

    <!-- Save Button -->
    <div class="mt-6 flex justify-end">
      <button type="button"
              (click)="saveData()"
              [disabled]="form.invalid"
              class="px-5 py-3 text-black font-semibold mt-5">
        Save Data
      </button>
    </div>

  </div>
</form>
